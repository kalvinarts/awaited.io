{"version":3,"sources":["../../src/examples/socket-io-example.js"],"names":["api","sqrt","ctx","num","Math","delaySqrt","secs","Promise","setTimeout","f","get","key","map","set","value","old","has","io","SocketIO","listen","Map","on","server","AwaitedIO","socket","use","next","msg","now","Date","ms","console","log","name","Object","keys","hasOwnProperty","register","ClientIO","client","remote","update","process","exit","main","require"],"mappings":"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","file":"socket-io-example.js","sourcesContent":["const AwaitedIO = require('../index.js');\nconst SocketIO = require('socket.io');\nconst ClientIO = require('socket.io-client');\n\nasync function main() {\n\n  // Setup a testing API\n  const api = {\n    \n    // A silly sqrt function\n    sqrt: (ctx, num) => Math.sqrt(num),\n\n    // The same dummy function, this time async\n    delaySqrt: (ctx, num, secs = 1) => {\n      return new Promise (f => {\n        setTimeout(() => {\n          f(Math.sqrt(num))\n        }, 1000 * secs);\n      })\n    },\n\n    // Some functions using a shared Map instance\n    get: (ctx, key) => {\n      return ctx.map.get(key);\n    },\n    set: (ctx, key, value) => {\n      let old = ctx.map.get(key);\n      ctx.map.set(key, value);\n    },\n    has: (ctx, key) => {\n      return ctx.map.has(key);\n    }\n  \n  };\n\n  // Setup a socket.io server\n  const io = new SocketIO().listen(3131);\n\n  // Setup the context that all API calls will share\n  const ctx = {\n    map: new Map()\n  };\n\n  io.on('connection', socket => {\n\n    // Create an AwaitedIO instance to wrap the socket using the created context\n    const server = new AwaitedIO(socket, { ctx });\n\n    // Register a middleware to debug things\n    server.use(async (next, ctx, msg) => {\n      const now = new Date();\n      await next();\n      const ms = new Date - now;\n      console.log(`${msg.name} - ${ms}ms`);\n    });\n\n    // Register the api functions\n    for (let name of Object.keys(api)) {\n      if (api.hasOwnProperty(name))\n        server.register(name, api[name]);\n    }\n\n  });\n\n  // Let's create a client to connect to our API\n  const socket = new ClientIO('http://localhost:3131');\n  const client = new AwaitedIO(socket);\n\n  // Update the remote functions\n  const remote = await client.update();\n  \n  // Test the sqrt functions\n  console.log('-- response:', await remote.sqrt(16));\n  console.log('-- response:', await remote.delaySqrt(4, 2));\n\n  // Test the context functions\n  await remote.set('test', 1234567890);\n  console.log('-- response:', await remote.has('test'));\n  console.log('-- response:', await remote.get('test'));\n\n  process.exit(0);\n}\n\nmain();\n"]}